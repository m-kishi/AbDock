<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>支出タブ</title>
    <link href="/AbDock/images/abdock.ico" rel="icon" type="image/ico" />
    <link href="/AbDock/stylesheets/normalize.css" rel="stylesheet" /><link href="/AbDock/stylesheets/all.css" rel="stylesheet" />
    <link href="/AbDock/stylesheets/mermaid.forest.min.css" rel="stylesheet" />
    <script src="/AbDock/javascripts/all.js"></script>
    <script src="/AbDock/javascripts/mermaid.min.js"></script>
  </head>
  <body class="f430_tab_expense">
    <header>
  <table class="header">
    <colgroup>
      <col class="title"   />
      <col class="project" />
      <col class="appname" />
      <col class="subname" />
      <col class="version" />
    </colgroup>
    <tbody>
      <tr>
        <td class="title"   rowspan="2">画面設計</td>
        <td class="project" rowspan="2">project.mk</td>
        <td class="appname" rowspan="2">Abook</td>
        <td class="subname" rowspan="2"></td>
        <td class="version">バージョン</td>
      </tr>
      <tr>
        <td class="version-number">5.6.0</td>
      </tr>
    </tbody>
  </table>
</header>

    <div class="content">
      <h1>【支出タブ】</h1>

<h2>レイアウト</h2>

<table class="layout">
    <tr>
      <td class="layout ">
        <figure>
            <img class="" src="/AbDock/images/tab_expense_001.png" />
            <figcaption>
              1.支出情報なし
            </figcaption>
        </figure>
      </td>
        <td rowspan="2" class="overview">
          <figure>
            <figcaption>＜概要＞</figcaption>
              <ul class="overview">
                  <li>支出情報を登録する画面</li>
                  <li><a href="/AbDock/f410_form_main.html">メインフォーム</a>の初期表示時に<a href="/AbDock/f200_dbfile.html">DBファイル</a>から読み込んだ支出情報を表示する．</li>
                  <li>DBファイルから読み込んだ支出情報が0件の場合，支出DGVは0行とする．</li>
                  <li>支出情報を初期表示するとき，支出DGVは最終行までスクロールして，日付列のセルを選択状態とする．</li>
              </ul>
              <figure>
                <figcaption>＜支出DGVの設定＞</figcaption>
                <table class="dgv-property">
                  <tr><th>行追加        </th><td>不可</td></tr>
                  <tr><th>行削除        </th><td>可能</td></tr>
                  <tr><th>ReadOnly      </th><td>×</td></tr>
                  <tr><th>列のソート    </th><td>不可</td></tr>
                  <tr><th>列の幅変更    </th><td>不可</td></tr>
                  <tr><th>選択モード    </th><td>行選択</td></tr>
                  <tr><th>スクロールバー</th><td>縦のみ</td></tr>
                </table>
              </figure>
          </figure>
        </td>
    </tr>
    <tr>
      <td class="layout ">
        <figure>
            <img class="" src="/AbDock/images/tab_expense_002.png" />
            <figcaption>
              2.支出情報あり
            </figcaption>
        </figure>
      </td>
    </tr>
</table>


<h2>画面項目</h2>


  <table class="controls">
    <tr>
      <th class="no-m">No.</th>
      <th>名称</th>
      <th>ＩＤ</th>
      <th>テキスト</th>
      <th>属性</th>
      <th>align</th>
      <th>種別</th>
      <th>備考</th>
    </tr>
      <tr>
  <td                >1</td>
  <td                >登録ボタン</td>
  <td                >BtnEntry</td>
  <td                >登録</td>
  <td                ></td>
  <td class="align-c"></td>
  <td                >Button</td>
  <td                ></td>
</tr>


      <tr>
  <td                >2</td>
  <td                >追加ボタン</td>
  <td                >BtnAddRow</td>
  <td                >＋</td>
  <td                ></td>
  <td class="align-c"></td>
  <td                >Button</td>
  <td                ></td>
</tr>


      <tr>
  <td                >3</td>
  <td                >支出DGV</td>
  <td                >DgvExpense</td>
  <td                ></td>
  <td                ></td>
  <td class="align-c"></td>
  <td                >DataGridView</td>
  <td                ></td>
</tr>

    <tr>
  <td                >3-1</td>
  <td                >日付列</td>
  <td                >ColDate</td>
  <td                >日付</td>
  <td                >文字列</td>
  <td class="align-c">左</td>
  <td                >DataGridViewTextBoxColumn</td>
  <td                >YYYY-MM-DD</td>
</tr>


    <tr>
  <td                >3-2</td>
  <td                >名称列</td>
  <td                >ColName</td>
  <td                >名称</td>
  <td                >文字列</td>
  <td class="align-c">左</td>
  <td                >DataGridViewTextBoxColumn</td>
  <td                ></td>
</tr>


    <tr>
  <td                >3-3</td>
  <td                >種別列</td>
  <td                >ColType</td>
  <td                >種別</td>
  <td                >文字列</td>
  <td class="align-c">中</td>
  <td                >DataGridViewTextBoxColumn</td>
  <td                ><a href="/AbDock/f600_type_define.html">種別※1</a>のみ</td>
</tr>


    <tr>
  <td                >3-4</td>
  <td                >金額列</td>
  <td                >ColCost</td>
  <td                >金額</td>
  <td                >数値</td>
  <td class="align-c">右</td>
  <td                >DataGridViewTextBoxColumn</td>
  <td                >Z,ZZ9</td>
</tr>



  </table>


<h2>イベント</h2>
<dl class="event">
  <dt>初期表示</dt>
  <dd>
    <ul class="description">
      <li>DBファイルから読み込んだ支出情報を支出DGVへ表示する．</li>
      <li>DBファイルから読み込んだ支出情報が0件の場合，支出DGVは0行とする．</li>
      <li>支出DGVの最終行までスクロールして，最終行の日付列のセルを選択状態とする．</li>
    </ul>
  </dd>
  <dt>登録ボタン押下</dt>
  <dd>
    <ul class="description">
      <li>
        支出DGVが0行の場合，警告ダイアログを表示して処理を終了する．
        <ul class="event">
          <li>
            警告：レコードが1件もありません．
            <figure><img src="/AbDock/images/tab_expense_err_norecord.png" /></figure>
          </li>
        </ul>
      </li>
      <li>支出DGVの支出情報をDBファイルへ出力する(すべての列が空白でない行のみを対象とする)．</li>
      <li>DBファイルへの書き出しに失敗した場合，エラーダイアログを表示して処理を終了する．</li>
      <li>
        このとき，エラーとなった行まで支出DGVをスクロールして，該当行を選択状態とする．
        <table class="db-file-store-error">
          <tr>
            <th class="no">No.</th>
            <th>条件</th>
            <th>メッセージ</th>
          </tr>
            <tr>
              <td class="no">1</td>
              <td>支出DGVの日付列の値が日付形式でない</td>
              <td><a href="/AbDock/f700_message_list.html#DATE_FORMAT">日付が正しくありません。</a></td>
            </tr>
            <tr>
              <td class="no">2</td>
              <td>支出DGVの種別列の値が不正</td>
              <td><a href="/AbDock/f700_message_list.html#TYPE_WRONG">種別が正しくありません。</a></td>
            </tr>
            <tr>
              <td class="no">3</td>
              <td>支出DGVの金額列の値が数値でない</td>
              <td><a href="/AbDock/f700_message_list.html#COST_FORMAT">金額が正しくありません。</a></td>
            </tr>
            <tr>
              <td class="no">4</td>
              <td>支出DGVの金額列の値がマイナス</td>
              <td><a href="/AbDock/f700_message_list.html#COST_MINUS">金額がマイナスです。</a></td>
            </tr>
            <tr>
              <td class="no">5</td>
              <td>支出DGVの金額列の値が大き過ぎる</td>
              <td><a href="/AbDock/f700_message_list.html#COST_OVERFLOW">金額が大き過ぎます。</a></td>
            </tr>
        </table>
        <table class="input-error">
          <tr>
            <td class="wide"><figure><img src="/AbDock/images/tab_expense_err_input_001.png" /></figure></td>
            <td class="diag"><figure><img src="/AbDock/images/tab_expense_err_input_002.png" /></figure></td>
            <td class="wide"><figure><img src="/AbDock/images/tab_expense_err_input_003.png" /></figure></td>
          </tr>
          <tr>
            <td><figure><figcaption>3-1.登録ボタンを押下      </figcaption></figure></td>
            <td><figure><figcaption>3-2.エラーダイアログ      </figcaption></figure></td>
            <td><figure><figcaption>3-3.該当行が選択状態となる</figcaption></figure></td>
          </tr>
        </table>
      </li>
      <li>
        DBファイルへの書き出しが成功した場合，各タブを初期化してOKダイアログを表示する．
        <ul class="event">
          <li>
            登録完了：正常に登録しました．
            <figure><img src="/AbDock/images/tab_expense_inf_complete.png" /></figure>
          </li>
        </ul>
      </li>
    </ul>
  </dd>
  <dt>追加ボタン押下</dt>
  <dd>
    <ul class="description">
      <li>支出DGVの末尾に新しく15行追加する．</li>
      <li>
        新しく追加された行の日付列にはシステム日付(YYYY-MM-DD)を初期値として設定する．
        <table class="event">
          <tr>
            <td>
              <figure>
                <img class="small" src="/AbDock/images/tab_expense_add_rows_001.png" />
                <figcaption>4-1.追加ボタン押下</figcaption>
              </figure>
            </td>
            <td>
              <figure>
                <img class="small" src="/AbDock/images/tab_expense_add_rows_002.png" />
                <figcaption>4-2.行が追加される</figcaption>
              </figure>
            </td>
          </tr>
        </table>
      </li>
    </ul>
  </dd>
  <dt>支出DGVのセル編集終了(CellEndEdit)</dt>
  <dd>
    <ul class="description">
      <li>編集したセルが名称列ならば，種別と金額の自動補完を行う．</li>
      <li>編集したセルが種別列ならば，金額の自動補完を行う．</li>
      <li>入力された名称が既に支出情報に登録されているなら，種別もそれと同じだろうという推測に基づく．</li>
      <li>金額は名称と種別の組み合せで直近3件の金額のどれかの可能性が高いだろうという推測に基づく．</li>
      <li>
        種別の具体的な補完手順は以下の通り．
        <ol class="event">
          <li>DBファイルから読み込んだ支出情報で編集したセルの名称と同じ支出情報をすべて取得する．<br />
              ※支出DGVに現在表示されている支出情報でないことに注意</li>
          <li>取得した支出情報が0件の場合，編集したセルの行の種別列を空白に設定する．</li>
          <li>取得した支出情報が1件以上の場合，それらを種別ごとにグループ分けする．</li>
          <li>グループ分けした中で件数が最大の種別を編集したセルの行の種別列に設定する．</li>
          <li>件数が最大の種別が複数存在する場合，それらをすべて空白で区切って編集したセルの行の種別列に設定する．</li>
        </ol>
      </li>
      <li>
        種別の自動補完の例を以下に示す．
        <table class="auto-complete">
            <tr>
                <td>
                  <figure>
                    <img class="small" src="/AbDock/images/tab_expense_complete_001.png" />
                    <figcaption>5-1.DBファイルの支出情報</figcaption>
                  </figure>
                </td>
                <td></td>
            </tr>
            <tr>
                <td>
                  <figure>
                    <img src="/AbDock/images/tab_expense_complete_002.png" />
                    <figcaption>5-2-1.「おにぎり」は「食費」が1件のみ</figcaption>
                  </figure>
                </td>
                <td>
                  <figure>
                    <img src="/AbDock/images/tab_expense_complete_003.png" />
                    <figcaption>5-2-2.「食費」で補完される</figcaption>
                  </figure>
                </td>
            </tr>
            <tr>
                <td>
                  <figure>
                    <img src="/AbDock/images/tab_expense_complete_004.png" />
                    <figcaption>5-3-1.「カレー」は「食費」が2件，「外食費」が1件</figcaption>
                  </figure>
                </td>
                <td>
                  <figure>
                    <img src="/AbDock/images/tab_expense_complete_005.png" />
                    <figcaption>5-3-2.「食費」で補完される</figcaption>
                  </figure>
                </td>
            </tr>
            <tr>
                <td>
                  <figure>
                    <img src="/AbDock/images/tab_expense_complete_006.png" />
                    <figcaption>5-4-1.「うどん」は「食費」と「外食費」が2件ずつ</figcaption>
                  </figure>
                </td>
                <td>
                  <figure>
                    <img src="/AbDock/images/tab_expense_complete_007.png" />
                    <figcaption>5-4-2.「食費」と「外食費」が空白区切りで補完される</figcaption>
                  </figure>
                </td>
            </tr>
        </table>
      </li>
      <li>
        金額の具体的な補完手順は以下の通り．
        <ol class="event">
          <li>DBファイルから読み込んだ支出情報のうち，編集したセルの名称 + 種別の組み合せに当てはまる支出情報をすべて取得する．<br />
              ※支出DGVに現在表示されている支出情報でないことに注意</li>
          </li>
          <li>取得した支出情報が0件の場合，編集したセルの行の金額列を空白に設定する．</li>
          <li>取得した支出情報が1件以上の場合，日付の新しい順に上位3件の金額を取得する．</li>
          <li>取得した金額で重複は一つにまとめる(SQLでのDISTINCT)．</li>
          <li>取得した金額を"/"で区切って編集したセルの行の金額列に設定する．<br />
              ※金額はカンマ編集する</li>
        </ol>
      </li>
      <li>
        金額の自動補完の例を以下に示す．
        <table class="auto-complete">
            <tr>
                <td>
                  <figure>
                    <img class="small" src="/AbDock/images/tab_expense_cost_complete_001.png" />
                    <figcaption>6-1.DBファイルの支出情報</figcaption>
                  </figure>
                </td>
                <td></td>
            </tr>
            <tr>
                <td>
                  <figure>
                    <img src="/AbDock/images/tab_expense_cost_complete_002.png" />
                    <figcaption>6-2-1.「おにぎり」+「食費」は1件のみ</figcaption>
                  </figure>
                </td>
                <td>
                  <figure>
                    <img src="/AbDock/images/tab_expense_cost_complete_003.png" />
                    <figcaption>6-2-2.「100」で補完される</figcaption>
                  </figure>
                </td>
            </tr>
            <tr>
                <td>
                  <figure>
                    <img src="/AbDock/images/tab_expense_cost_complete_004.png" />
                    <figcaption>6-3-1.「おにぎり」+「外食費」は2件</figcaption>
                  </figure>
                </td>
                <td>
                  <figure>
                    <img src="/AbDock/images/tab_expense_cost_complete_005.png" />
                    <figcaption>6-3-2.日付の新しい順に「300/200」で補完される</figcaption>
                  </figure>
                </td>
            </tr>
            <tr>
                <td>
                  <figure>
                    <img src="/AbDock/images/tab_expense_cost_complete_006.png" />
                    <figcaption>6-4-1.「カレー」+「外食費」は4件</figcaption>
                  </figure>
                </td>
                <td>
                  <figure>
                    <img src="/AbDock/images/tab_expense_cost_complete_007.png" />
                    <figcaption>6-4-2.日付の新しい順の3件で補完される</figcaption>
                  </figure>
                </td>
            </tr>
            <tr>
                <td>
                  <figure>
                    <img src="/AbDock/images/tab_expense_cost_complete_008.png" />
                    <figcaption>6-5-1.「うどん」+「食費」は直近3件の金額がすべて同じ</figcaption>
                  </figure>
                </td>
                <td>
                  <figure>
                    <img src="/AbDock/images/tab_expense_cost_complete_009.png" />
                    <figcaption>6-5-2.一つにまとめて「100」で補完される</figcaption>
                  </figure>
                </td>
            </tr>
            <tr>
                <td>
                  <figure>
                    <img src="/AbDock/images/tab_expense_cost_complete_010.png" />
                    <figcaption>6-6-1.「うどん」+「外食費」は1件目と3件目の金額が同じ</figcaption>
                  </figure>
                </td>
                <td>
                  <figure>
                    <img src="/AbDock/images/tab_expense_cost_complete_011.png" />
                    <figcaption>6-6-2.同じ金額は一つにまとめられる</figcaption>
                  </figure>
                </td>
            </tr>
        </table>
      </li>
    </ul>
  </dd>
  <dt>支出DGV上でのキー押下(KeyDown)</dt>
  <dd>
    <ul class="description">
      <li>押下されたキーがCtrl+V(ペースト)の場合，現在選択されてるセルにクリップボードの値をペーストする．</li>
      <li>現在選択されているセルが名称列の場合，ペースト終了後に種別と金額の自動補完を行う．</li>
      <li>現在選択されているセルが種別列の場合，ペースト終了後に金額の自動補完を行う．</li>
    </ul>
  </dd>
</dl>

    </div>
    <footer>
  <table class="footer">
    <tr>
      <td class="link">
        <a href="/AbDock/">トップページ</a> | 
        <a href="https://github.com/m-kishi/Abook">Abook</a> | 
        <a href="https://github.com/m-kishi/AbDock">GitHub</a>
      </td>
    </tr>
    <tr>
      <td class="copy-rights">
        Copyright &copy; 2016 m-kishi All Rights Reserved.
      </td>
    </tr>
  </table>
</footer>

    <script>mermaid.initialize({startOnLoad:true});</script>
  </body>
</html>
