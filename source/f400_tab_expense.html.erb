---
title: 支出タブ
header_title: 画面設計
header_project: project.mk
header_appname: Abook
header_subname:
---
<h1>【<%= current_page.data.title %>】</h1>
<section>
  <h2>レイアウト</h2>
  <table>
    <tr>
      <td class="layout">
        <figure>
          <%= image_tag 'tab_expense_001.png' %>
          <figcaption>1.支出情報なし</figcaption>
        </figure>
      </td>
      <td rowspan="2" class="overview">
        <figure>
          <figcaption>概要</figcaption>
          <ul>
            <li>支出情報を登録する画面</li>
            <li><%= link_main %>の初期表示時に<%= link_dbfile %>から読み込んだ支出情報を初期表示する．</li>
            <li>DBファイルから読み込んだ支出情報が0件の場合，支出DGVは0行とする．</li>
            <li>支出情報を初期表示するとき，支出DGVは最終行までスクロールして，日付列のセルを選択状態とする．</li>
          </ul>
        </figure>
        <figure>
          <figcaption>支出DGVの設定</figcaption>
          <table class="dgv-property">
            <tr><th>行追加        </th><td><%= data.char.FUKA            %></td></tr>
            <tr><th>行削除        </th><td><%= data.char.KANO            %></td></tr>
            <tr><th>ReadOnly      </th><td><%= data.char.BOOLF           %></td></tr>
            <tr><th>列の幅変更    </th><td><%= data.char.FUKA            %></td></tr>
            <tr><th>列のソート    </th><td><%= data.char.FUKA            %></td></tr>
            <tr><th>選択モード    </th><td><%= data.char.SELECT_CEL      %></td></tr>
            <tr><th>スクロールバー</th><td><%= data.char.SCROLL_VERTICAL %></td></tr>
          </table>
        </figure>
      </td>
    </tr>
    <tr>
      <td class="layout">
        <figure>
          <%= image_tag 'tab_expense_002.png' %>
          <figcaption>2.支出情報あり</figcaption>
        </figure>
      </td>
    </tr>
  </table>
</section>
<section>
  <h2>画面項目</h2>
  <table class="controls">
    <tr><th class="no-m">No.</th><th>名称      </th><th>ＩＤ      </th><th>テキスト</th><th>属性                     </th><th                >align                   </th><th>種別                     </th><th>備考                                   </th></tr>
    <tr><td class="no-m">1  </td><td>登録ボタン</td><td>BtnEntry  </td><td>"登録"  </td><td>                         </td><td class="align-c">                        </td><td>Button                   </td><td>                                       </td></tr>
    <tr><td class="no-m">2  </td><td>追加ボタン</td><td>BtnAddRow </td><td>"＋"    </td><td>                         </td><td class="align-c">                        </td><td>Button                   </td><td>                                       </td></tr>
    <tr><td class="no-m">3  </td><td>支出DGV   </td><td>DgvExpense</td><td>        </td><td>                         </td><td class="align-c">                        </td><td>DataGridView             </td><td>                                       </td></tr>
    <tr><td class="no-m">3-1</td><td>日付列    </td><td>ColDate   </td><td>"日付"  </td><td><%= data.char.ATTR_STR %></td><td class="align-c"><%= data.char.ALIGN_L %></td><td>DataGridViewTextBoxColumn</td><td><%= data.char.FMT_DT %>                </td></tr>
    <tr><td class="no-m">3-2</td><td>名称列    </td><td>ColName   </td><td>"名称"  </td><td><%= data.char.ATTR_STR %></td><td class="align-c"><%= data.char.ALIGN_L %></td><td>DataGridViewTextBoxColumn</td><td>                                       </td></tr>
    <tr><td class="no-m">3-3</td><td>種別列    </td><td>ColType   </td><td>"種別"  </td><td><%= data.char.ATTR_STR %></td><td class="align-c"><%= data.char.ALIGN_C %></td><td>DataGridViewTextBoxColumn</td><td><%= link_type data.char.TYPE_EXP %>のみ</td></tr>
    <tr><td class="no-m">3-4</td><td>金額列    </td><td>ColCost   </td><td>"金額"  </td><td><%= data.char.ATTR_NUM %></td><td class="align-c"><%= data.char.ALIGN_R %></td><td>DataGridViewTextBoxColumn</td><td><%= data.char.FMT_COMMA %>             </td></tr>
  </table>
</section>
<section>
  <h2>イベント</h2>
  <dl class="event">
    <dt>初期表示</dt>
    <dd>
      DBファイルから読み込んだ支出情報を支出DGVへ表示する．<br />
      DBファイルから読み込んだ支出情報が0件の場合，支出DGVは0行とする．<br />
      支出DGVの最終行までスクロールして，最終行の日付列のセルを選択状態とする．
    </dd>
    <dt>登録ボタン押下</dt>
    <dd>
      支出DGVが0行の場合，警告ダイアログを表示して処理を終了する．
      <ul class="event">
        <li>
          警告：レコードが1件もありません．
          <figure><%= image_tag 'tab_expense_err_norecord.png' %></figure>
        </li>
      </ul>
      支出DGVの支出情報をDBファイルへ出力する．すべての列が空白でない行のみを対象とする．<br />
      DBファイルへの書き出しに失敗した場合，エラーダイアログを表示して処理を終了する．<br />
      このとき，エラーとなった行まで支出DGVをスクロールして，該当行を選択状態とする．
      <ul class="event">
        <li><%= message_link '支出DGVの日付が日付形式でない', :DATE_FORMAT    %></li>
        <li><%= message_link '支出DGVの種別列が不正'        , :TYPE_WRONG     %></li>
        <li><%= message_link '支出DGVの金額列が数値でない'  , :COST_FORMAT    %></li>
        <li><%= message_link '支出DGVの金額列がマイナス'    , :COST_MINUS     %></li>
        <li><%= message_link '支出DGVの金額列が大き過ぎる'  , :COST_OVERFLOW  %></li>
      </ul>
      <table class="input-error">
        <tr>
          <td class="wide"><figure><%= image_tag 'tab_expense_err_input_001.png'%></figure></td>
          <td class="diag"><figure><%= image_tag 'tab_expense_err_input_002.png'%></figure></td>
          <td class="wide"><figure><%= image_tag 'tab_expense_err_input_003.png'%></figure></td>
        </tr>
        <tr>
          <td><figure><figcaption>3-1.登録ボタンを押下      </figcaption></figure></td>
          <td><figure><figcaption>3-2.エラーメッセージ      </figcaption></figure></td>
          <td><figure><figcaption>3-3.該当行が選択状態となる</figcaption></figure></td>
        </tr>
      </table>
      DBファイルへの書き出しが成功した場合，各タブを初期化してOKダイアログを表示する．
      <ul class="event">
        <li>
          登録完了：正常に登録しました．
          <figure><%= image_tag 'tab_expense_inf_complete.png' %></figure>
        </li>
      </ul>
    </dd>
    <dt>追加ボタン押下</dt>
    <dd>
      支出DGVの末尾に新しく15行追加する．<br />
      新しく追加された行の日付列にはシステム日時(<%= data.char.FMT_DT %>)を初期値として設定する．
      <table class="event">
        <tr>
          <td><figure><%= image_tag 'tab_expense_add_rows_001.png', class: 'small' %><figcaption>4-1.追加ボタン押下</figcaption></figure></td>
          <td><figure><%= image_tag 'tab_expense_add_rows_002.png', class: 'small' %><figcaption>4-2.行が追加される</figcaption></figure></td>
        </tr>
      </table>
    </dd>
    <dt>支出DGVのセル編集終了(CellEndEdit)</dt>
    <dd>
      セルの編集終了後に種別の自動補完を行う(編集したセルが名称列の場合)．
      <ol class="event">
        <li>DBファイルから読み込んだ支出情報で編集したセルの名称と同じ支出情報を取得する．<br />
            ※支出DGVに現在表示されている支出情報でないことに注意</li>
        <li>取得した支出情報が0件の場合，編集したセルの行の種別列を空白に設定する．</li>
        <li>取得した支出情報が1件以上の場合，それらの支出情報から種別ごとの件数をカウントする．</li>
        <li>カウントした件数が最大の種別を編集したセルの行の種別列に設定する．</li>
        <li>最大の種別が複数件存在する場合，それらをすべて空白で区切ってセルの行の種別列に設定する．</li>
      </ol>
      <table class="auto-complete">
        <tr>
          <td>
            <figure>
              <%= image_tag 'tab_expense_complete_001.png', class: 'small' %>
              <figcaption>5.DBファイルの支出情報</figcaption>
            </figure>
          </td>
          <td>
          </td>
        </tr>
        <tr>
          <td><figure><%= image_tag 'tab_expense_complete_002.png' %><figcaption>6-1."おにぎり"は"食費"が1件のみ</figcaption></figure></td>
          <td><figure><%= image_tag 'tab_expense_complete_003.png' %><figcaption>6-2."食費"が補完される</figcaption></figure></td>
        </tr>
        <tr>
          <td><figure><%= image_tag 'tab_expense_complete_004.png' %><figcaption>7-1."カレー"は"食費"が2件，"外食費"が1件</figcaption></figure></td>
          <td><figure><%= image_tag 'tab_expense_complete_005.png' %><figcaption>7-2.件数最大の"食費"が補完される</figcaption></figure></td>
        </tr>
        <tr>
          <td><figure><%= image_tag 'tab_expense_complete_006.png' %><figcaption>8-1."うどん"は"食費"が2件，"外食費"が2件</figcaption></figure></td>
          <td><figure><%= image_tag 'tab_expense_complete_007.png' %><figcaption>8-2.件数最大の"食費"と"外食費"が空白区切りで補完される</figcaption></figure></td>
        </tr>
      </table>
    </dd>
    <dt>支出DGV上でのキー押下(KeyDown)</dt>
    <dd>
      押下されたキーがCtrl+V(ペースト)の場合，現在選択されてるセルにクリップボードの値を設定する(ペーストする)．<br />
      現在選択されているセルが名称列の場合，ペースト終了後に種別の自動補完を行う．
    </dd>
  </dl>
</section>
